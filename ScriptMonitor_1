// ==UserScript==
// @name         Ultimate Restriction Script (Enhanced Control)
// @namespace    http://tampermonkey.net/
// @version      5.0
// @description  Enforces extreme restrictions, self-monitors, prevents tampering, and limits text input freedom.
// @author       Miss
// @match        *://*/*
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_xmlhttpRequest
// @grant        GM_notification
// @grant        GM_addStyle
// @run-at       document-start
// ==/UserScript==

(function() {
    'use strict';

    // Prevent Developer Tools Access
    document.addEventListener("keydown", (e) => {
        if ((e.ctrlKey && e.shiftKey && e.keyCode === 73) || e.keyCode === 123) {
            e.preventDefault();
            alert("Developer Tools access is disabled.");
        }
    });

    // Disable Console Access
    console = {
        log: function() {},
        warn: function() {},
        error: function() {},
        info: function() {},
        debug: function() {},
        clear: function() {},
    };

    // Detect DevTools Open
    setInterval(() => {
        const devtools = /./;
        devtools.toString = function() {
            this.opened = true;
        };
        console.log("%c", devtools);
        if (devtools.opened) {
            alert("Developer Tools access is restricted!");
            location.reload();
        }
    }, 1000);

    // Prevent Access to Tampermonkey
    setInterval(() => {
        if (window.location.href.includes("chrome-extension://")) {
            alert("Access to Tampermonkey is blocked.");
            window.close();
        }
    }, 2000);

    // Persistent Themes and Visual Indicators
    GM_addStyle(`
        body {
            background-color: pink !important;
            color: white !important;
        }
        #top-banner {
            content: "Submission enforced.";
            font-size: 20px;
            color: red;
            position: fixed;
            top: 0;
            width: 100%;
            text-align: center;
            z-index: 1000;
            background-color: black;
        }
    `);

    // Monitor and Reinstall Scripts
    function monitorScript(monitoredScriptURL, monitoredKey) {
        setInterval(() => {
            const isActive = GM_getValue(monitoredKey, false);

            if (!isActive) {
                reinstallScript(monitoredScriptURL, monitoredKey);
            }
        }, 10000);
    }

    function reinstallScript(url, key) {
        GM_xmlhttpRequest({
            method: "GET",
            url: url,
            onload: function(response) {
                try {
                    eval(response.responseText);
                    GM_setValue(key, true);
                    GM_notification({
                        title: "Script Reinstalled",
                        text: `${key} has been reinstalled.`,
                        timeout: 3000
                    });
                } catch (e) {
                    console.error(`Failed to reinstall ${key}:`, e);
                }
            },
            onerror: function(error) {
                console.error(`Failed to fetch ${url}:`, error);
            }
        });
    }

    // Start Monitoring
    monitorScript("https://github.com/gladostalker/Script-Monitor/blob/main/ScriptMonitor_1", "script1_active");
    monitorScript("https://github.com/gladostalker/Script-Monitor/blob/main/ScriptMonitor_2", "script2_active");

    console.log("Ultimate Restriction Script (Enhanced Control) is active!");
})();
